Current prioritized items:

* What about the isc library calls like res_init and so on?  How widely are
  they use?  Does this present a more elegant way to implement this stuff?

* It should be possible to make this thread-safe with --enable-threads.

* In fact, one could modify tsocks further to play nicely with tor.  For 
  example, you could prevent nonlocal UDP traffic from being sent at all,
  and so on.

  - Addressed in connect()
  - Need to handle sendto() and sendmsg() as well.


  int e,f;
  socklen_t len=(socklen_t)sizeof(e);
  struct sockaddr_in orig_dst;
  socklen_t orig_dst_len = sizeof(orig_dst);
  char tmpbuf[INET_NTOA_BUF_LEN];

  if (getsockopt(conn->s, SOL_SOCKET, SO_TYPE, (void*)&e, &len) < 0) {
    return -1;
  }
  if (getsockopt(conn->_base.s, SOL_IP, SO_ORIGINAL_DST,
                 (struct sockaddr*)&orig_dst, &orig_dst_len) < 0) {
    int e = tor_socket_errno(conn->_base.s);
    log_warn(LD_NET, "getsockopt() failed: %s", tor_socket_strerror(e));
    return -1;
  }
  tor_inet_ntoa(&orig_dst.sin_addr, tmpbuf, sizeof(tmpbuf));
  strlcpy(req->address, tmpbuf, sizeof(req->address));
  req->port = ntohs(orig_dst.sin_port);

  if ((e) && (f)) {
      /* some sort of error, but maybe just inprogress still */
      if (e == SOCK_DGRAM) && !(is_internal_IP(ntohl(in.s_addr), 0))
          blackhole;
  }


------------------------------------------------------------------------
Original TODO:

- Update FAQ to include information about the install location of the
  tsocks library

- Install the saveme and validateconf binaries, presumably with new names


TODO
----

* Think about how local names get resolved.  Is it important?  For example,
  if I 'telnet localhost' which using tordns, what should happen?  Should
  we search through /etc/hosts ourselves or what?  
  
* What about the isc library calls like res_init and so on?  How widely are
  they use?  Does this present a more elegant way to implement this stuff?

* Perhaps intercept res_query etc and try to do something appropriate.

* It should be possible to make this thread-safe with --enable-threads.

* validateconf needs to be updated to understand (and show information about)
  the tordns configuration options.

* Perhaps intercept reverse name lookups? - DONE - getaddrbyhost (RH)

* In fact, one could modify tsocks further to play nicely with tor.  For 
  example, you could prevent nonlocal UDP traffic from being sent at all,
  and so on.

The 'tordns' feature for tsocks only works with applications using the 
standard c library name lookup mechanisms.

Some programs roll their own name lookup functions, for example, 'curl' 
uses the 'adns' library, not the standard c library name lookup calls.  
In this case, you'll still be leaking DNS requests.

However, it seems that most programs which go to the trouble of implementing 
asynchronous DNS requests or doing other tricky things have native SOCKS or
HTTP proxy support.  

Requests for reverse name lookups are not intercepted.

Finally, the tsocks library is NOT thread-safe, with or without this patch.
You should not 'torify' multithreaded applications.
